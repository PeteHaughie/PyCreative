# Typing guide for PyCreative

This short guide describes the small, pragmatic typing foundation used in PyCreative and how to use it when annotating code.

Goals
- Provide a small set of well-named aliases for common concepts (colors, points, matrices).
- Make incremental typing low-risk: prefer conservative unions where code is dynamic.
- Provide a clear pattern for handling "pending" sentinel values used throughout the runtime.
- Give quick commands to run a static type-checker and tests.

Where the types live
- `src/pycreative/types.py` â€” the single source of truth for the small alias set used across the package.

Aliases and intent
- Number = float | int
  - Use for values that are numeric in the API but may be either int or float.

- RGB = Tuple[int, int, int]
- RGBA = Tuple[int, int, int, int]
- ColorLike = Union[RGB, RGBA, "pycreative.color.Color"]
  - Use this for public APIs that accept colors in Processing-style forms (3- or 4-tuples) or `pycreative.color.Color` instances.
  - Note: `pycreative.color.Color` is referenced as a string to avoid importing color at module import time.
- ColorOrNone = Optional[ColorLike]
  - Use where a color or `None` is accepted (e.g., disabling fill/stroke).

- Point = Tuple[float, float]
  - Use for (x,y) coordinate tuples.

- Matrix = list[list[float]]
  - A 3x3 transform matrix. Use for `get_matrix()`/`set_matrix()` annotations.

Sentinel handling
- The runtime uses a sentinel `_PENDING_UNSET = object()` to record that no pending value was set.
- Many sketch attributes are typed as `X | Any` (e.g., `ColorOrNone | Any`) while they may hold the sentinel. This keeps static checkers quiet while preserving runtime safety.
- Pattern:
  - For public method signatures, prefer precise aliases (e.g., `color: ColorOrNone`).
  - For internal `self._pending_*` fields that may temporarily hold the sentinel, use a conservative type (e.g., `ColorOrNone | Any`) or `Union[ColorOrNone, object]`.

Minimizing friction while annotating
- Start by annotating public function signatures with `ColorLike`/`Point`/`Matrix`.
- For attributes that store coerced runtime-friendly values (pygame-friendly tuples), prefer `Optional[Tuple[int, ...]]` (allows RGB or RGBA).
- When the runtime needs to accept both 3- and 4-length tuples, prefer `Tuple[int, ...]` for internal storage and `ColorLike` for public params.

Examples

Annotating a Surface method that accepts flexible colors:

```py
from pycreative.types import ColorOrNone, Point

def rect(self, x: float, y: float, w: float, h: float, fill: ColorOrNone = None) -> None:
    ...
```

Coercion helper:

```py
from pycreative.types import ColorLike, ColorOrNone

def _coerce_input_color(self, color_val: ColorLike | None) -> ColorOrNone:
    # returns a 3- or 4-tuple or None
    ...
```

Pending values that use the sentinel:

```py
# inside Sketch.__init__
self._pending_fill: ColorOrNone | Any = _PENDING_UNSET
```

Static-checking recommendations
- Run the full test suite first to ensure runtime behavior is solid:

```bash
pytest -q
```

- Use a lightweight checker (pyright is fast and easy to adopt):

```bash
# install once in your environment
npm install -g pyright
# run in the repo root
pyright
```

- Or run mypy with a conservative config (prefer `--ignore-missing-imports` initially):

```bash
pip install mypy
mypy --ignore-missing-imports src tests
```

Migration strategy (recommended incremental approach)
1. Add `ColorLike`/`Point`/`Matrix` imports to the module you're changing.
2. Annotate public method signatures first (surface API, sketch helpers).
3. Update internal storage types where safe (e.g., change `_fill` from `Tuple[int,int,int]` to `Tuple[int,...]`).
4. Use `cast(...)` at call-sites where a value may be a sentinel or a more flexible runtime type and the static checker complains.
5. Run tests, then run pyright/mypy and fix the top failures (do a few files at a time).

Notes and gotchas
- Avoid importing heavy modules at top-level in modules that are imported by the CLI (e.g., avoid `pygame` at module import time in `cli` modules unless necessary).
- Prefer lazy imports inside functions if importing causes circular imports or heavy startup cost.
- Keep the sentinel `_PENDING_UNSET` as `Any` in annotations where removing `Any` would cause more noise than value.

If you want
- I can add a `pyrightconfig.json` or `mypy.ini` with conservative defaults and a CI job fragment to run the type checks.
- I can run pyright across the repo and propose a prioritized set of typing fixes.

---
Generated by the project maintainers' typing plan. Keep this page updated as more aliases are added or types are refined.
